jobs:
  update:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    permissions:
      contents: write

    steps:
      # ...（其他步骤不变）

      - name: 设置Python（稳定版3.10）
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip'

      - name: 安装依赖（直接用pip）
        run: |
          pip install --upgrade pip
          pip install aiohttp tqdm opencc-python-reimplemented lxml

      # ...（后续步骤不变）

      - name: 运行EPG生成脚本
        run: |
          echo "=== 开始生成EPG ==="
          rm -rf output/* 2>/dev/null || true
          set -x
          python merge.py 2>&1 | tee epg_output.log  # 直接用python运行，不用pipenv
          set +x
          echo "=== 生成日志 ==="
          cat epg_output.log || echo "无日志"
